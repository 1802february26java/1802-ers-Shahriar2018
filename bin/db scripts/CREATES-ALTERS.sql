/********** Creates **********/

CREATE TABLE USER_T (
    U_ID NUMBER NOT NULL,
    U_FIRSTNAME VARCHAR2(20) NOT NULL,
    U_LASTNAME VARCHAR2(20) NOT NULL,
    U_USERNAME VARCHAR2(20) NOT NULL,
    U_PASSWORD VARCHAR2(100) NOT NULL,
    U_EMAIL VARCHAR2(100) NOT NULL,
    UR_ID NUMBER NOT NULL,
    CONSTRAINT PK_USER PRIMARY KEY (U_ID)
);

CREATE TABLE USER_ROLE (
    UR_ID NUMBER NOT NULL,
    UR_TYPE VARCHAR2(20),
    CONSTRAINT PK_USER_ROLE PRIMARY KEY (UR_ID)
);

CREATE TABLE REIMBURSEMENT (
    R_ID NUMBER NOT NULL,
    R_REQUESTED TIMESTAMP NOT NULL,
    R_RESOLVED TIMESTAMP NULL,
    R_AMOUNT NUMBER(8,2) NOT NULL,
    R_DESCRIPTION VARCHAR2(4000),
    R_RECEIPT BLOB NULL,
    EMPLOYEE_ID NUMBER NOT NULL,
    MANAGER_ID NUMBER NULL,
    RS_ID NUMBER NOT NULL,
    RT_ID NUMBER NOT NULL,
    CONSTRAINT PK_REIMBURSEMENT PRIMARY KEY (R_ID)
);

CREATE TABLE REIMBURSEMENT_STATUS (
    RS_ID NUMBER NOT NULL,
    RS_STATUS VARCHAR2(20) NOT NULL,
    CONSTRAINT PK_REIMBURSEMENT_STATUS PRIMARY KEY (RS_ID)
);

CREATE TABLE REIMBURSEMENT_TYPE (
    RT_ID NUMBER NOT NULL,
    RT_TYPE VARCHAR2(20) NOT NULL,
    CONSTRAINT PK_REIMBURSEMENT_TYPE PRIMARY KEY (RT_ID)
);

CREATE TABLE PASSWORD_RECOVERY (
    PR_ID NUMBER NOT NULL,
    PR_TOKEN VARCHAR2(100) NOT NULL,
    PR_TIME TIMESTAMP NOT NULL,
    U_ID NUMBER NOT NULL,
    CONSTRAINT PK_PASSWORD_RECOVERY PRIMARY KEY (PR_ID)
);

/********** Foreign Keys **********/

/* USER */
ALTER TABLE USER_T ADD CONSTRAINT FK_USER_ROLE
    FOREIGN KEY (UR_ID) REFERENCES USER_ROLE (UR_ID);

ALTER TABLE PASSWORD_RECOVERY ADD CONSTRAINT FK_USER_PR
    FOREIGN KEY (U_ID) REFERENCES USER_T (U_ID);

/* REIMBURSEMENT */
ALTER TABLE REIMBURSEMENT ADD CONSTRAINT FK_REIMBURSEMENT_EMPLOYEE
    FOREIGN KEY (EMPLOYEE_ID) REFERENCES USER_T (U_ID);

ALTER TABLE REIMBURSEMENT ADD CONSTRAINT FK_REIMBURSEMENT_MANAGER
    FOREIGN KEY (MANAGER_ID) REFERENCES USER_T (U_ID);  

ALTER TABLE REIMBURSEMENT ADD CONSTRAINT FK_REIMBURSEMENT_STATUS
    FOREIGN KEY (RS_ID) REFERENCES REIMBURSEMENT_STATUS (RS_ID);

ALTER TABLE REIMBURSEMENT ADD CONSTRAINT FK_REIMBURSEMENT_TYPE
    FOREIGN KEY (RT_ID) REFERENCES REIMBURSEMENT_TYPE (RT_ID);

/********** Uniques **********/
ALTER TABLE USER_T ADD CONSTRAINT UNQ_USERNAME
    UNIQUE (U_USERNAME);

ALTER TABLE USER_ROLE ADD CONSTRAINT UNQ_USER_ROLE
    UNIQUE (UR_TYPE);

ALTER TABLE REIMBURSEMENT_STATUS ADD CONSTRAINT UNQ_REIMBURSEMENT_STATUS
    UNIQUE (RS_STATUS);

ALTER TABLE REIMBURSEMENT_TYPE ADD CONSTRAINT UNQ_REIMBURSEMENT_TYPE
    UNIQUE (RT_TYPE);